var words_lana = {
    "baby": {
        "polarity": 195,
        "count": 195
    },
    "love": {
        "polarity": 195,
        "count": 195
    },
    "life": {
        "polarity": 195,
        "count": 120
    },
    "day": {
        "polarity": 195,
        "count": 195
    },
    "lights": {
        "polarity": 195,
        "count": 70
    },
    "heart": {
        "polarity": 195,
        "count": 60
    },
    "nothing": {
        "polarity": 195,
        "count": 60
    },
    "man": {
        "polarity": 20,
        "count": 50
    },
    "girl": {
        "polarity": 30,
        "count": 30
    },
    "blue": {
        "polarity": 30,
        "count": 80
    },
    "ice": {
        "polarity": 30,
        "count": 40
    },
    "dress": {
        "polarity": 30,
        "count": 40
    },
    "mind": {
        "polarity": 25,
        "count": 25
    }, 
    "night": {
        "polarity": 30,
        "count": 60
    },
    "jazz": {
        "polarity": 30,
        "count": 30
    }, 
    "sun": {
        "polarity": 30,
        "count": 37
    },
    "voice": {
        "polarity": 30,
        "count": 32
    },
    "crazy": {
        "polarity": 30,
        "count": 66
    },
    "nail polish": {
        "polarity": 30,
        "count": 20
    },
    "coney island": {
        "polarity": 30,
        "count": 32
    },
    "saigon": {
        "polarity": 30,
        "count": 22
    },
    "daddy": {
        "polarity": 30,
        "count": 120
    },
    "lip gloss": {
        "polarity": 20,
        "count": 22
    },
    "motel": {
        "polarity": 20,
        "count": 22
    },
    "hotel": {
        "polarity": 20,
        "count": 22
    },
    "american sweetheart": {
        "polarity": 20,
        "count": 23
    },
    "bathing suit": {
        "polarity": 20,
        "count": 22
    },
    "queen": {
        "polarity": 20,
        "count": 45
    },
    "king": {
        "polarity": 20,
        "count": 40
    },
    "corvett": {
        "polarity": 20,
        "count": 20
    },
    "summer": {
        "polarity": 20,
        "count": 60
    },
    "july": {
        "polarity": 20,
        "count": 32
    },
    "america": {
        "polarity": 20,
        "count": 100
    },
    "dream": {
        "polarity": 30,
        "count": 22
    },
    "ride": {
        "polarity": 30,
        "count": 31
    },
    "florida": {
        "polarity": 30,
        "count": 25
    },
   "trailer park": {
       "polarity": 30,
       "count": 30
   },
    "flower": {
        "polarity": 21,
        "count": 17
    },
   "cherry pie": {
       "polarity": 21,
       "count": 20
   },
   "california": {
       "polarity": 20,
       "count": 86
   },
   "ice cream": {
       "polarity": 10,
       "count": 12
   },
   "red": {
       "polarity": 1,
       "count": 50
   },
   "diamonds": {
       "polarity": 1,
       "count": 20
   },
   "pearls": {
       "polarity": 1,
       "count": 20
   },
   "hollywood": {
       "polarity": 3,
       "count": 70
   },
   "swimming pool": {
       "polarity": 20,
       "count": 20
   },
   "new york": {
       "polarity": 1,
       "count": 80
   },
   "god": {
       "polarity": 1,
       "count": 30
   },
   "jesus": {
       "polarity": 1,
       "count": 30
   },
   "heaven": {
       "polarity": 1,
       "count": 30
   },
   "alcohol": {
       "polarity": 1,
       "count": 42
   },
   "death": {
       "polarity": -1,
       "count": 60
   },
   "paradise": {
       "polarity": 1,
       "count": 32
   },
   "beaches": {
       "polarity": 1,
       "count": 7
   },
   "peaches": {
       "polarity": 9,
       "count": 16
   },
   "war": {
       "polarity": 1,
       "count": 12
   },
   "suicide blonde": {
       "polarity": 1,
       "count": 17
   },
   "fire": {
       "polarity": 1,
       "count": 23
   },
   "elvis": {
       "polarity": 1,
       "count": 12
   },
   "live fast": {
       "polarity": 1,
       "count": 12
   },
   "die young": {
       "polarity": -1,
       "count": 9
   },
   "easy rider": {
       "polarity": 195,
       "count": 10
   },
   "leather": {
       "polarity": 1,
       "count": 13
   },
   "drop it like it's hot": {
       "polarity": 2,
       "count": 14
   },
   "driving": {
       "polarity": 1,
       "count": 29
   },
   "pale moonlight": {
       "polarity": 1,
       "count": 37
   },
   "alive again": {
       "polarity": 11,
       "count": 32
   },
   "dope": {
       "polarity": 1,
       "count": 17
   },
   "blue ribbon": {
       "polarity": 1,
       "count": 10
   },
   "roller coaster": {
       "polarity": 1,
       "count": 7
   },
   "santa monica": {
       "polarity": 1,
       "count": 28
   },
   "rock n roll": {
       "polarity": 1,
       "count": 32
   },
   "nancy and sid": {
       "polarity": 1,
       "count": 9
   },
   "butterflies": {
       "polarity": 1,
       "count": 22
   },
   "singing the blues": {
       "polarity": 1,
       "count": 12
   },
   "ocean": {
       "polarity": 1,
       "count": 7
   },
   "sea": {
       "polarity": 1,
       "count": 5
   },
   "prison": {
       "polarity": -1,
       "count": 5
   },
   "denim": {
       "polarity": 1,
       "count": 5
   },
   "greenwich": {
       "polarity": 1,
       "count": 8
   },
   "blue hydrangea": {
       "polarity": 1,
       "count": 20
   },
   "downtown scene": {
       "polarity": 1,
       "count": 27
   },
   "weather": {
       "polarity": 1,
       "count": 7
   },
   "heart shaped sunglasses": {
       "polarity": 1,
       "count": 12
   },
   "remedy for memory": {
       "polarity": 1,
       "count": 5
   },
   "blue hydrangea": {
       "polarity": 1,
       "count": 20
   },
   "ultraviolence": {
       "polarity": -1,
       "count": 4
   },
   "morisson": {
       "polarity": 1,
       "count": 2
   },
   "chateau marmont": {
       "polarity": 2,
       "count": 10
   },
   "gas station": {
       "polarity": 2,
       "count": 7
   },
   "vine": {
       "polarity": 2,
       "count": 23
   },
   "chevy": {
       "polarity": 3,
       "count": 5
   },
   "pick up truck": {
       "polarity": 2,
       "count": 7
   },
   "poison ivy": {
       "polarity": -2,
       "count": 3
   },
   "gold": {
       "polarity": 2,
       "count": 27
   },
   "jersey": {
       "polarity": 2,
       "count": 22
   },
   "action axion": {
       "polarity": 2,
       "count": 17
   },
   "mercedes": {
       "polarity": 2,
       "count": 7
   },
   "party": {
       "polarity": 2,
       "count": 27
   },
   "coca cola": {
       "polarity": 2,
       "count": 15
   },
   "mountain dew": {
       "polarity": 2,
       "count": 7
   },
   "pepsi cola": {
       "polarity": 2,
       "count": 12
   },
   "cadillac": {
       "polarity": 2,
       "count": 11
   },
   "salvatore": {
       "polarity": 2,
       "count": 4
   },
   "jim": {
       "polarity": 195,
       "count": 14
   },
   "bathing suit": {
       "polarity": 2,
       "count": 7
   },
   "pontiac": {
       "polarity": 2,
       "count": 10
   },
   "lollipops": {
       "polarity": 2,
       "count": 18
   }
}

var shuffling = true; // shuffling make less-sparsed word clouds
var spiral = "archimedean"; // 'archimedean or 'rectangular'
var outter = true; // (try to) make disappearing words outter

var person = "lana";
var zoom_group; // reusable d3 selection

var words = {};
Object.keys(words_lana).forEach(function (word_lemma) {
    words[word_lemma] = {
        "lana": words_lana[word_lemma],
        "jesus": {
            "polarity": words_lana[word_lemma].polarity,
            "count": 0
        }
    }
});

Math.seedrandom('abcde'); // define a fixed random seed, to avoid to have a different layout on each page reload. change the string to randomize

var words_frequency = [];
var max = -Infinity;
Object.keys(words).forEach(function (word_lemma) {
    o = words[word_lemma];
    o.lemma = word_lemma;
    o.maxCount = Math.max(o.lana.count, o.jesus.count);

    words_frequency.push(o);
    if (max < o.maxCount) {
        max = o.maxCount;
    }
});
console.log("max: " + max);


var font_size = d3.scale.linear()
    .domain([1, max])
    .range([10, 100]);


// var color = d3.scale.linear()
//     .domain([-max, 0, max])
//     .range([d3.hcl(36, 65, 50), d3.hcl(95, 65, 80), d3.hcl(150, 65, 50)])
//     .interpolate(d3.interpolateHcl);

var color = d3.scale.quantize()
    .domain([-max, max])
    .range([d3.hcl(36, 65, 50), d3.hcl(150, 65, 50)]);

if (shuffling) {
    shuffle(words_frequency);
}
words_frequency.sort(function (a, b) {
    if (outter) {
        return (b.maxCount - a.maxCount) +
            (((b.lana.count === 0) || (b.jesus.count === 0)) ? 1 : 0);
    } else {
        return (b.maxCount - a.maxCount);
    }
});

d3.layout.cloud().size([960, 500])
    .words(words_frequency)
    .rotate(function () {
        return ~~(Math.random() * 2) * 90;
    })
    .font("Impact")
    .spiral(spiral)
    .text(function (d) {
        return d.lemma;
    })
    .fontSize(function (d) {
        return font_size(d.maxCount);
    })
    .on("end", draw)
    .start();

function draw(words) {
    var svg = d3.select("body").append("svg")
        .attr("width", 960)
        .attr("height", 500);


    // append a group for zoomable content
    zoom_group = svg.append('g');

    // define a zoom behavior
    var zoom = d3.behavior.zoom()
        .scaleExtent([1, 4]) // min-max zoom
        .on('zoom', function () {
            // whenever the user zooms,
            // modify translation and scale of the zoom group accordingly
            zoom_group.attr('transform', 'translate(' + zoom.translate() + ')scale(' + zoom.scale() + ')');
        });

    // bind the zoom behavior to the main SVG
    svg.call(zoom);


    zoom_group.append("g")
        .attr("transform", "translate(480,250)")
        .selectAll("text")
        .data(words)
        .enter()
        .append("text")
        .style("font-size", function (d) {
            return font_size(d[person].count) + "px";
        })
        .style("font-family", "Impact")
        .style("fill", function (d) {
            return color(d[person].polarity);
        })
        .style("fill-opacity", function (d) {
            return (d[person].count > 0) ? 1 : 0;
        })
        .attr("text-anchor", "middle")
        .attr("transform", function (d) {
            var far = 1500 * (Math.random() > 0.5 ? +1 : -1);
            if (d.rotate === 0)
                return "translate(" + far + ",0)rotate(" + d.rotate + ")";
            else
                return "translate(0," + far + ")rotate(" + d.rotate + ")";
        })
        .text(function (d) {
            return d.lemma;
        })
        .transition()
        .duration(2000)
        .attr("transform", function (d) {
            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
        });
}

function shuffle(array) {
    let counter = array.length;

    // While there are elements in the array
    while (counter > 0) {
        // Pick a random index
        let index = Math.floor(Math.random() * counter);

        // Decrease counter by 1
        counter--;

        // And swap the last element with it
        let temp = array[counter];
        array[counter] = array[index];
        array[index] = temp;
    }

    return array;
}